var ot;if(typeof window<"u"&&window.navigation){let n=window.navigation;en(n),ot=n}function en(n){if(!n)throw new Error("Expected Navigation")}function st(n){function t(e){return!!e}return t(n)&&(typeof n.type=="string"||typeof n.type=="symbol")}function we(n,t){if(!st(n))throw new Error("Expected event");if(typeof t<"u"&&n.type!==t)throw new Error(`Expected event type ${String(t)}, got ${n.type.toString()}`)}function Se(n){return st(n)&&n.parallel!==!1}var q=class extends Error{constructor(t){super(`AbortError${t?`: ${t}`:""}`),this.name="AbortError"}};function xt(n){return n instanceof Error&&n.name==="AbortError"}var v=class extends Error{constructor(t){super(`InvalidStateError${t?`: ${t}`:""}`),this.name="InvalidStateError"}};function xe(n){return n instanceof Error&&n.name==="InvalidStateError"}function nn(n){function t(e){return typeof e=="object"}return t(n)&&typeof n.aborted=="boolean"&&typeof n.addEventListener=="function"}function $(n){function t(e){return e.hasOwnProperty("signal")}return st(n)&&t(n)&&nn(n.signal)}function Tt(n,t){if($(n)&&n.signal.aborted&&t instanceof Error&&xt(t))return!0}var F=Symbol.for("@opennetwork/environment/events/target/listeners"),Ot=Symbol.for("@opennetwork/environment/events/target/listeners/ignore"),at=Symbol.for("@opennetwork/environment/events/target/listeners/match"),z=Symbol.for("@opennetwork/environment/events/target/listeners/this");var Nt=Symbol.for("@opennetwork/environment/events/descriptor");function kt(n,t,e){let i=r(e)?e:void 0;return o=>i?i===o:(!t||t===o.callback)&&n===o.type;function r(o){function a(s){return!!s}return a(o)&&o[Nt]===!0}}function Xt(n){return typeof n=="function"}var B=Symbol.for("@virtualstate/navigation/event-target/descriptors"),ct=class{[B]=[];[Ot]=new WeakSet;get[F](){return[...this[B]??[]]}[at](t){let e=this[F],i=[...new Set([...e??[],...this[B]??[]])].filter(o=>o.type===t||o.type==="*").filter(o=>!this[Ot]?.has(o)),r=typeof t=="string"?this[`on${t}`]:void 0;return typeof r=="function"&&Xt(r)&&i.push({type:t,callback:r,[Nt]:!0}),i}addEventListener(t,e,i){let r={...i,isListening:()=>!!this[B]?.find(kt(t,e)),descriptor:{[Nt]:!0,...i,type:t,callback:e},timestamp:Date.now()};r.isListening()||this[B]?.push(r.descriptor)}removeEventListener(t,e,i){if(!Xt(e))return;let r=this[F]??this[B]??[],o=r.findIndex(kt(t,e,i));if(o===-1)return;let a=this[B]?.findIndex(kt(t,e,i))??-1;a!==-1&&this[B]?.splice(a,1);let s=r[o];s&&this[Ot]?.add(s)}hasEventListener(t,e){return e&&!Xt(e)?!1:(this[B]?.findIndex(kt(t,e))??-1)>-1}};var Q=class extends ct{[z];constructor(t=void 0){super(),this[z]=t}async dispatchEvent(t){let e=this[at]?.(t.type)??[];if($(t)&&t.signal.aborted)throw new q;let i=Se(t),r=[];for(let o=0;o<e.length;o+=1){let a=e[o],s=(async()=>{a.once&&this.removeEventListener(a.type,a.callback,a),await a.callback.call(this[z]??this,t)})();if(i)r.push(s);else{try{await s}catch(c){Tt(t,c)||await Promise.reject(c)}if($(t)&&t.signal.aborted)return}}if(r.length){let a=(await Promise.allSettled(r)).filter(s=>s.status==="rejected");if(a.length){let s=a;if($(t)&&t.signal.aborted&&(s=s.filter(c=>!Tt(t,c.reason))),s.length===1)throw await Promise.reject(s[0].reason),s[0].reason;if(s.length>1)throw new AggregateError(s.map(({reason:c})=>c))}}}};var rn={EventTarget:Q,AsyncEventTarget:Q,SyncEventTarget:Q},te=rn,ee=te.EventTarget||te.SyncEventTarget||te.AsyncEventTarget;function on(n){if(typeof n!="function")throw new Error("Could not load EventTarget implementation")}var ut=class extends Q{constructor(...t){if(super(),ee){on(ee);let{dispatchEvent:e}=new ee(...t);this.dispatchEvent=e}}};var Te=class extends ct{[z];constructor(t=void 0){super(),this[z]=t}dispatchEvent(t){let e=this[at]?.(t.type)??[];if($(t)&&t.signal.aborted)throw new q;for(let i=0;i<e.length;i+=1){let r=e[i];r.once&&this.removeEventListener(r.type,r.callback,r);try{r.callback.call(this[z]??this,t)}catch(o){if(!Tt(t,o))throw o}if($(t)&&t.signal.aborted)throw new q}}};var ft=class extends ut{addEventListener(t,e,i){return r(e),super.addEventListener(t,e,typeof i=="boolean"?{once:i}:i);function r(o){if(typeof o!="function")throw new Error("Please us the function variant of event listener")}}removeEventListener(t,e,i){return r(e),super.removeEventListener(t,e);function r(o){if(typeof o!="function")throw new Error("Please us the function variant of event listener")}}};var sn="crypto"in globalThis&&typeof globalThis.crypto.randomUUID=="function",lt=sn?globalThis.crypto.randomUUID.bind(globalThis.crypto):()=>Array.from({length:5},()=>`${Math.random()}`.replace(/^0\./,"")).join("-").replace(".","");var Ne=Symbol.for("@virtualstate/navigation/getState"),Ut=Symbol.for("@virtualstate/navigation/entry/navigationType"),It=Symbol.for("@virtualstate/navigation/entry/knownAs"),ne=Symbol.for("@virtualstate/navigation/entry/setState");function Ie(n){return typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"||typeof n=="string"}function ke(n){return!!(n||Ie(n))}var ht=class extends ft{#n;#t;get index(){return typeof this.#n=="number"?this.#n:this.#n()}key;id;url;sameDocument;get[Ut](){return this.#i.navigationType}get[It](){let t=new Set(this.#i[It]);return t.add(this.id),t}#i;get[F](){return[...super[F]??[],...this.#i[F]??[]]}constructor(t){super(),this.#i=t,this.key=t.key||lt(),this.id=lt(),this.url=t.url??void 0,this.#n=t.index,this.sameDocument=t.sameDocument??!0,this.#t=t.state??void 0}[Ne](){return this.#i?.getState?.(this)}getState(){let t=this.#t;if(!ke(t)){let e=this[Ne]();ke(e)&&(t=this.#t=e)}return typeof t>"u"||Ie(t)?t:(typeof t=="function"&&(console.warn("State passed to Navigation.navigate was a function, this may be unintentional"),console.warn("Unless a state value is primitive, with a standard implementation of Navigation"),console.warn("your state value will be serialized and deserialized before this point, meaning"),console.warn("a function would not be usable.")),{...t})}[ne](t){this.#t=t}};function ie(n){let t,e,i=new Promise((r,o)=>{t=r,e=o});return Le(t),Le(e),{resolve:t,reject:e,promise:n?i.catch(n):i}}function Le(n){if(!n)throw new Error("Value not provided")}var re=typeof AbortController<"u"?AbortController:void 0;if(!re)throw new Error("AbortController expected to be available or polyfilled");var jt=re;function Ft(n){return G(n)&&typeof n.then=="function"}function M(n,t="Expected value"){if(!n)throw new Error(t)}function Ce(n){return n.status==="rejected"}function G(n){return!!n}var an="This will be removed when the first major release of @virtualstate/navigation is published",Pe={EVENT_INTERCEPT_HANDLER:`You are using a non standard interface, please update your code to use event.intercept({ async handler() {} })
${an}`},Ae=!1,Re=!0;function cn(n){Ae=n}function un(n){Re=n}function oe(n,...t){if(!Ae)try{Re?console.trace(Pe[n],...t):console.warn(Pe[n],...t)}catch{}}var Y=Symbol.for("@virtualstate/navigation/rollback"),ue=Symbol.for("@virtualstate/navigation/unset"),Ht=Symbol.for("@virtualstate/navigation/transition/parentEventTarget"),V=Symbol.for("@virtualstate/navigation/transition/deferred/finished"),U=Symbol.for("@virtualstate/navigation/transition/deferred/committed"),tt=Symbol.for("@virtualstate/navigation/transition/navigationType"),et=Symbol.for("@virtualstate/navigation/transition/entries/initial"),se=Symbol.for("@virtualstate/navigation/transition/entries/finished"),Pt=Symbol.for("@virtualstate/navigation/transition/index/initial"),ae=Symbol.for("@virtualstate/navigation/transition/index/finished"),P=Symbol.for("@virtualstate/navigation/transition/entry"),De=Symbol.for("@virtualstate/navigation/transition/isCommitted"),_t=Symbol.for("@virtualstate/navigation/transition/isFinished"),ce=Symbol.for("@virtualstate/navigation/transition/isRejected"),Ct=Symbol.for("@virtualstate/navigation/transition/known"),fe=Symbol.for("@virtualstate/navigation/transition/promises"),R=Symbol.for("@virtualstate/navigation/intercept"),nt=Symbol.for("@virtualstate/navigation/transition/isOngoing"),Oe=Symbol.for("@virtualstate/navigation/transition/isPending"),Wt=Symbol.for("@virtualstate/navigation/transition/isAsync"),At=Symbol.for("@virtualstate/navigation/transition/wait"),Ue=Symbol.for("@virtualstate/navigation/transition/promise/resolved"),dt=Symbol.for("@virtualstate/navigation/transition/rejected"),Gt=Symbol.for("@virtualstate/navigation/transition/beforeCommit"),Mt=Symbol.for("@virtualstate/navigation/transition/commit"),X=Symbol.for("@virtualstate/navigation/transition/finish"),je=Symbol.for("@virtualstate/navigation/transition/start"),Fe=Symbol.for("@virtualstate/navigation/transition/start/deadline"),le=Symbol.for("@virtualstate/navigation/transition/error"),_e=Symbol.for("@virtualstate/navigation/transition/finally"),K=Symbol.for("@virtualstate/navigation/transition/abort"),Lt=Symbol.for("@virtualstate/navigation/transition/intercept/options/commit"),Kt=Symbol.for("@virtualstate/navigation/transition/commit/isManual"),pt=class extends ut{finished;committed;from;navigationType;[Wt]=!1;[Lt];#n;[V]=ie();[U]=ie();get[Oe](){return!!this.#t.size}get[tt](){return this.#n[tt]}get[et](){return this.#n[et]}get[Pt](){return this.#n[Pt]}get[Kt](){return!!(this[Lt]?.includes("after-transition")||this[Lt]?.includes("manual"))}[se];[ae];[De]=!1;[_t]=!1;[ce]=!1;[nt]=!1;[Ct]=new Set;[P];#t=new Set;#i=!1;#e=new jt;get signal(){return this.#e.signal}get[fe](){return this.#t}constructor(t){super(),this[Lt]=[],this[V]=t[V]??this[V],this[U]=t[U]??this[U],this.#n=t;let e=this.finished=this[V].promise,i=this.committed=this[U].promise;e.catch(o=>o),i.catch(o=>o),this.from=t.from,this.navigationType=t.navigationType,this[se]=t[se],this[ae]=t[ae];let r=t[Ct];if(r)for(let o of r)this[Ct].add(o);this[P]=t[P],this.addEventListener(Mt,this.#a,{once:!0}),this.addEventListener(X,this.#s,{once:!0}),this.addEventListener(Mt,this.#r,{once:!0}),this.addEventListener(X,this.#o,{once:!0}),this.addEventListener(le,this.#c,{once:!0}),this.addEventListener(K,()=>{if(!this[_t])return this[dt](new q)}),this.addEventListener("*",this[P].dispatchEvent.bind(this[P])),this.addEventListener("*",t[Ht].dispatchEvent.bind(t[Ht]))}rollback=t=>{if(this.#i)throw new v("Rollback invoked multiple times: Please raise an issue at https://github.com/virtualstate/navigation with the use case where you want to use a rollback multiple times, this may have been unexpected behaviour");return this.#i=!0,this.#n.rollback(t)};#r=()=>{this[De]=!0};#o=()=>{this[_t]=!0};#s=()=>{this[V].resolve(this[P])};#a=()=>{this.signal.aborted||this[U].resolve(this[P])};#c=t=>this[dt](t.error);[Ue]=(...t)=>{for(let e of t)this.#t.delete(e)};[dt]=async t=>{if(this[ce])return;this[ce]=!0,this[K]();let e=this[tt];if((typeof e=="string"||e===Y)&&(await this.dispatchEvent({type:"navigateerror",error:t,get message(){return t instanceof Error?t.message:`${t}`}}),e!==Y&&!(xe(t)||xt(t))))try{await this.rollback()?.finished}catch{throw new v("Failed to rollback, please raise an issue at https://github.com/virtualstate/navigation/issues")}this[U].reject(t),this[V].reject(t)};[R]=t=>{let e=this,i=o();if(this[nt]=!0,!i)return;this[Wt]=!0;let r=i.then(()=>({status:"fulfilled",value:void 0})).catch(async a=>(await this[dt](a),{status:"rejected",reason:a}));this.#t.add(r);function o(){if(!t)return;if(Ft(t))return oe("EVENT_INTERCEPT_HANDLER"),t;if(typeof t=="function")return oe("EVENT_INTERCEPT_HANDLER"),t();let{handler:a,commit:s}=t;if(s&&typeof s=="string"&&e[Lt].push(s),typeof a=="function")return a()}};[At]=async()=>{if(!this.#t.size)return this[P];try{let t=[...this.#t],i=(await Promise.all(t)).filter(r=>r.status==="rejected");if(i.length)throw i.length===1?i[0].reason:typeof AggregateError<"u"?new AggregateError(i.map(({reason:r})=>r)):new Error;return this[Ue](...t),this[Oe]?this[At]():this[P]}catch(t){throw await this.#c(t),await Promise.reject(t)}finally{await this[X]()}};[K](){this.#e.signal.aborted||(this.#e.abort(),this.dispatchEvent({type:K,transition:this,entry:this[P]}))}[X]=async()=>{this[_t]||await this.dispatchEvent({type:X,transition:this,entry:this[P],intercept:this[R]})}};function fn(){try{if(typeof window<"u"&&window.location)return window.location.href}catch{}}function gt(n){let t=fn()??"https://html.spec.whatwg.org/";return new URL((n??"").toString(),t)}function He(){let n,t,e=!1,i="pending",r=new Promise((o,a)=>{n=s=>{i="fulfilled",e=!0,o(s)},t=s=>{i="rejected",e=!0,a(s)}});return M(n),M(t),{get settled(){return e},get status(){return i},resolve:n,reject:t,promise:r}}var mt=class{type;from;navigationType;constructor(t,e){if(this.type=t,!e)throw new TypeError("init required");if(!e.from)throw new TypeError("from required");this.from=e.from,this.navigationType=e.navigationType??void 0}};var qt=class{type;canIntercept;canTransition;destination;downloadRequest;formData;hashChange;info;signal;userInitiated;navigationType;constructor(t,e){if(this.type=t,!e)throw new TypeError("init required");if(!e.destination)throw new TypeError("destination required");if(!e.signal)throw new TypeError("signal required");this.canIntercept=e.canIntercept??!1,this.canTransition=e.canIntercept??!1,this.destination=e.destination,this.downloadRequest=e.downloadRequest,this.formData=e.formData,this.hashChange=e.hashChange??!1,this.info=e.info,this.signal=e.signal,this.userInitiated=e.userInitiated??!1,this.navigationType=e.navigationType??"push"}commit(){throw new Error("Not implemented")}intercept(t){throw new Error("Not implemented")}preventDefault(){throw new Error("Not implemented")}reportError(t){throw new Error("Not implemented")}scroll(){throw new Error("Not implemented")}transitionWhile(t){return this.intercept(t)}};var he=Symbol.for("@virtualstate/navigation/formData"),de=Symbol.for("@virtualstate/navigation/downloadRequest"),ln=Symbol.for("@virtualstate/navigation/canIntercept"),$t=Symbol.for("@virtualstate/navigation/userInitiated"),Bt=Symbol.for("@virtualstate/navigation/originalEvent"),tr=Symbol.for("@virtualstate/navigation/event/abortController");function hn(){}function dn(n,t){let e=t.index;return e!==-1?e:-1}function We(n){let{commit:t,currentIndex:e,options:i,known:r,currentEntry:o,transition:a,transition:{[et]:s,[P]:c,[R]:p},reportError:N}=n,{transition:{[tt]:f}}=n,l=[...s],E=new Set(r),h=-1,S=e;if(f===Y){let{index:T}=i??{index:void 0};if(typeof T!="number")throw new v("Expected index to be provided for rollback");h=T,S=T}else f==="traverse"||f==="reload"?(h=dn(s,c),S=h):f==="replace"?e===-1?(f="push",h=e+1,S=h):(h=e,S=e):(h=e+1,S=h);if(typeof h!="number"||h===-1)throw new v("Could not resolve next index");if(!c.url)throw console.trace({navigationType:f,entry:c,options:i}),new v("Expected entry url");let I={url:c.url,key:c.key,id:c.id,index:h,sameDocument:c.sameDocument,getState(){return c.getState()}},j=!1,u=gt(o?.url),L=new URL(I.url),b=u.hash,H=L.hash;if(b!==H){let T=new URL(u.toString());T.hash="";let O=new URL(L.toString());O.hash="",j=T.toString()===O.toString()}let d,{resolve:w,promise:y}=He();function C(){M(d,"Expected contextToCommit"),w(t(d))}let k=new jt,g=new qt("navigate",{signal:k.signal,info:void 0,...i,canIntercept:i?.[ln]??!0,formData:i?.[he]??void 0,downloadRequest:i?.[de]??void 0,hashChange:j,navigationType:i?.navigationType??(typeof f=="string"?f:"replace"),userInitiated:i?.[$t]??!1,destination:I}),m=i?.[Bt],x=a[K].bind(a);if(m){let T=m;g.intercept=function(A){return T.preventDefault(),p(A)},g.preventDefault=function(){return T.preventDefault(),x()}}else g.intercept=p,g.preventDefault=x;g.transitionWhile=g.intercept,g.commit=C,N&&(g.reportError=N),g.scroll=hn,m&&(g.originalEvent=m);let W=new mt("currententrychange",{from:o,navigationType:g.navigationType}),Z=[],wt=[],St=[],Ee=s.map(T=>T.key);if(f===Y){let{entries:T}=i??{entries:void 0};if(!T)throw new v("Expected entries to be provided for rollback");l=T,l.forEach(A=>E.add(A));let O=l.map(A=>A.key);wt=s.filter(A=>!O.includes(A.key)),St=l.filter(A=>!Ee.includes(A.key))}else if(f==="replace"||f==="traverse"||f==="reload"){l[I.index]=c,f!=="traverse"&&Z.push(c),f==="replace"&&(l=l.slice(0,I.index+1));let T=l.map(O=>O.key);wt=s.filter(O=>!T.includes(O.key)),Ee.includes(c.id)&&(St=[c])}else if(f==="push"){let T=!1;if(l[I.index]&&(l=l.slice(0,I.index),T=!0),l.push(c),St=[c],T){let O=l.map(A=>A.key);wt=s.filter(A=>!O.includes(A.key))}}E.add(c);let be;return(Z.length||St.length||wt.length)&&(be={updatedEntries:Z,addedEntries:St,removedEntries:wt}),d={entries:l,index:S,known:E,entriesChange:be},{entries:l,known:E,index:S,currentEntryChange:W,destination:I,navigate:g,navigationType:f,waitForCommit:y,commit:C,abortController:k}}function _(n){if(typeof CustomEvent<"u"&&typeof n.type=="string"){if(n instanceof CustomEvent)return n;let{type:t,detail:e,...i}=n,r=new CustomEvent(t,{detail:e??i});return Object.assign(r,i),we(r,n.type),r}return n}var Vt=Symbol.for("@virtualstate/navigation/setOptions"),Rt=Symbol.for("@virtualstate/navigation/setEntries"),Me=Symbol.for("@virtualstate/navigation/setCurrentIndex"),zt=Symbol.for("@virtualstate/navigation/setCurrentKey"),vt=Symbol.for("@virtualstate/navigation/getState"),pe=Symbol.for("@virtualstate/navigation/setState"),Ge=Symbol.for("@virtualstate/navigation/disposeState");function pn(n){return n==="reload"||n==="push"||n==="replace"||n==="traverse"}var it=class extends ft{#n=0;#t=[];#i=new Set;#e=-1;#r;#o=new WeakSet;#s="";#a=void 0;#c=void 0;get canGoBack(){return!!this.#t[this.#e-1]}get canGoForward(){return!!this.#t[this.#e+1]}get currentEntry(){return this.#e===-1?(this.#a||(this.#a=new ht({getState:this[vt],navigationType:"push",index:-1,sameDocument:!1,url:this.#s.toString()})),this.#a):this.#t[this.#e]}get transition(){let t=this.#r;return t?.signal.aborted?void 0:t}constructor(t={}){super(),this[Vt](t)}[Vt](t){this.#c=t,this.#s=gt(t?.baseURL),this.#t=[],t.entries&&this[Rt](t.entries),t.currentKey?this[zt](t.currentKey):typeof t.currentIndex=="number"&&this[Me](t.currentIndex)}[zt](t){let e=this.#t.findIndex(i=>i.key===t);e!==-1&&(this.#e=e)}[Me](t){t<=-1||t>=this.#t.length||(this.#e=t)}[Rt](t){this.#t=t.map(({key:e,url:i,navigationType:r,state:o,sameDocument:a},s)=>new ht({getState:this[vt],navigationType:pn(r)?r:"push",sameDocument:a??!0,index:s,url:i,key:e,state:o})),this.#e===-1&&this.#t.length&&(this.#e=0)}[vt]=t=>this.#c?.getState?.(t)??void 0;[pe]=t=>this.#c?.setState?.(t);[Ge]=t=>this.#c?.disposeState?.(t);back(t){if(!this.canGoBack)throw new v("Cannot go back");let e=this.#t[this.#e-1];return this.#u("traverse",this.#f(e,{...t,navigationType:"traverse"}))}entries(){return[...this.#t]}forward(t){if(!this.canGoForward)throw new v;let e=this.#t[this.#e+1];return this.#u("traverse",this.#f(e,{...t,navigationType:"traverse"}))}goTo(t,e){return this.traverseTo(t,e)}traverseTo(t,e){let i=this.#t.find(r=>r.key===t);if(i)return this.#u("traverse",this.#f(i,{...e,navigationType:"traverse"}));throw new v}#h=t=>{function e(r,o){return r.origin===o.origin}let i=this.currentEntry?.url;return i?e(new URL(i),new URL(t)):!0};navigate(t,e){let i=this.#s;this.currentEntry?.url&&(i=this.currentEntry?.url);let r=new URL(t,i).toString(),o="push";e?.history==="auto"||!e?.history?r===this.currentEntry?.url&&(o="replace"):(e?.history==="push"||e?.history==="replace")&&(o=e?.history);let a=this.#l({getState:this[vt],url:r,...e,sameDocument:this.#h(r),navigationType:o});return this.#u(o,a,void 0,e)}#f=(t,e)=>this.#l({...t,getState:this[vt],index:t?.index??void 0,state:e?.state??t?.getState(),navigationType:t?.[Ut]??(typeof e?.navigationType=="string"?e.navigationType:"replace"),...e,get[It](){return t?.[It]},get[F](){return t?.[F]}});#l=t=>{let e=t.key||(t.navigationType==="replace"?this.currentEntry?.key:void 0),i=new ht({...t,key:e,index:t.index??(()=>this.#t.indexOf(i))});return i};#u=(t,e,i,r)=>{if(e===this.currentEntry)throw new v;if(this.#t.findIndex(a=>a.id===e.id)>-1)throw new v;return this.#d(t,e,i,r)};#d=(t,e,i,r)=>{let o=i??new pt({from:this.currentEntry,navigationType:typeof t=="string"?t:"replace",rollback:p=>this.#m(o,p),[tt]:t,[et]:[...this.#t],[Pt]:this.#e,[Ct]:[...this.#i],[P]:e,[Ht]:this}),{finished:a,committed:s}=o,c=()=>this.#g(t,e,o,r);return this.#p(o),c().catch(p=>{}),{committed:s,finished:a}};#p=t=>{this.#o.add(t)};#g=(t,e,i,r)=>{try{return this.#n+=1,this.#v(t,e,i,r)}finally{this.#n-=1}};#m=(t,e)=>{let i=t[et],r=t[Pt],o=i[r],a=o?this.#f(o,e):void 0,s={...e,index:r,known:new Set([...this.#i,...i]),navigationType:a?.[Ut]??"replace",entries:i},c=a?Y:ue,p=a??this.#l({getState:this[vt],navigationType:"replace",index:s.index,sameDocument:!0,...e});return this.#u(c,p,void 0,s)};#v=(t,e,i,r)=>{let o=t,a=gn();a&&e.sameDocument&&typeof o=="string"&&a?.mark?.(`same-document-navigation:${e.id}`);let s=!1,c=!1,{currentEntry:p}=this;this.#r?.finished?.catch(u=>u),this.#r?.[V]?.promise?.catch(u=>u),this.#r?.[U]?.promise?.catch(u=>u),this.#r?.[K](),this.#r=i;let N=i.dispatchEvent({type:je,transition:i,entry:e}),f=({entries:u,index:L,known:b})=>{i.signal.aborted||(this.#t=u,b&&(this.#i=new Set([...this.#i,...b])),this.#e=L,this[pe](this.currentEntry))},l=async u=>{if(c)return;let L=[i.dispatchEvent(_({type:Gt,transition:i,entry:e}))];if(i.signal.aborted)return;c=!0,f(u);let{entriesChange:b}=u;L.push(i.dispatchEvent(_({type:Mt,transition:i,entry:e}))),b&&L.push(this.dispatchEvent(_({type:"entrieschange",...b}))),await Promise.all(L)},E=async()=>{if(await N,!(typeof r?.index=="number"&&r.entries))throw new v;let u=this.entries(),L=u.map(w=>w.key),b=r.entries.map(w=>w.key),H=u.filter(w=>!b.includes(w.key)),d=r.entries.filter(w=>!L.includes(w.key));return await l({entries:r.entries,index:r.index,known:r.known,entriesChange:H.length||d.length?{removedEntries:H,addedEntries:d,updatedEntries:[]}:void 0}),await this.dispatchEvent(_({type:"currententrychange"})),s=!0,e},h=()=>{if(t===ue)return E();let u=We({currentEntry:p,currentIndex:this.#e,options:r,transition:i,known:this.#i,commit:l,reportError:i[dt]}),L=new Promise(queueMicrotask),b=[],H=I(u)[Symbol.iterator](),d={[Symbol.iterator]:()=>({next:()=>H.next()})};async function w(){for(let C of d){if(Ft(C)&&b.push(Promise.allSettled([C]).then(([k])=>k)),i[Kt]||s&&i[Wt])return y().then(w);if(i.signal.aborted)break}if(b.length)return y()}async function y(){let C=[...b];if(C.length){b=[];let g=(await Promise.all(C)).filter(Ce);if(g.length===1)throw await Promise.reject(g[0]);if(g.length)throw new AggregateError(g,g[0].reason?.message)}else i[nt]||await L}return w().then(()=>i[nt]?void 0:L).then(()=>e)},S=async()=>this.#y();function*I(u){let L=new Promise(queueMicrotask),{currentEntryChange:b,navigate:H,waitForCommit:d,commit:w,abortController:y}=u,C=y.abort.bind(y);if(i.signal.addEventListener("abort",C,{once:!0}),typeof o=="string"||o===Y){let k=p?.dispatchEvent(_({type:"navigatefrom",intercept:i[R],transitionWhile:i[R]}));k&&(yield k)}typeof o=="string"&&(yield i.dispatchEvent(H)),i[Kt]||w(),yield d,e.sameDocument&&(yield i.dispatchEvent(b)),s=!0,typeof o=="string"&&(yield e.dispatchEvent(_({type:"navigateto",intercept:i[R],transitionWhile:i[R]}))),yield S(),i[fe].size||(yield L),yield i.dispatchEvent({type:Fe,transition:i,entry:e}),yield i[At](),i.signal.removeEventListener("abort",C),yield i[X](),typeof o=="string"&&(yield i.dispatchEvent(_({type:"finish",intercept:i[R],transitionWhile:i[R]})),yield i.dispatchEvent(_({type:"navigatesuccess",intercept:i[R],transitionWhile:i[R]})))}let j=()=>{try{return h()}catch(u){return Promise.reject(u)}};return Promise.allSettled([j()]).then(async([u])=>{u.status==="rejected"&&await i.dispatchEvent({type:le,error:u.reason,transition:i,entry:e}),await S(),await i.dispatchEvent({type:_e,transition:i,entry:e}),await i[At](),this.#r===i&&(this.#r=void 0),e.sameDocument&&typeof o=="string"&&(a.mark(`same-document-navigation-finish:${e.id}`),a.measure(`same-document-navigation:${e.url}`,`same-document-navigation:${e.id}`,`same-document-navigation-finish:${e.id}`))}).then(()=>e)};#y=async()=>{for(let t of this.#i){if(this.#t.findIndex(r=>r.id===t.id)!==-1)continue;this.#i.delete(t);let i=_({type:"dispose",entry:t});this[Ge](t),await t.dispatchEvent(i),await this.dispatchEvent(i)}};reload(t){let{currentEntry:e}=this;if(!e)throw new v;let i=this.#f(e,t);return this.#u("reload",i,void 0,t)}updateCurrentEntry(t){let{currentEntry:e}=this;if(!e)throw new v("Expected current entry");e[ne](t.state),this[pe](e);let i=new mt("currententrychange",{from:e,navigationType:void 0}),r=_({type:"entrieschange",addedEntries:[],removedEntries:[],updatedEntries:[e]});return Promise.all([this.dispatchEvent(i),this.dispatchEvent(r)])}};function gn(){return typeof performance<"u"?performance:{now(){return Date.now()},mark(){},measure(){}}}var ge;function Yt(){return ot?ot:ge||(ge=new it)}var me=JSON;function mn(n){me=n}function Ke(n){return me.stringify(n)}function qe(n){return me.parse(n)}var vn=Symbol.for("@virtualstate/navigation/location/checkChange"),Zt=Symbol.for("@virtualstate/navigation/location/awaitFinished"),yt=Symbol.for("@virtualstate/navigation/location/transitionURL"),D=Symbol.for("@virtualstate/navigation/location/url"),yn="https://html.spec.whatwg.org/",Jt=class{#n;#t;constructor(t){this.#n=t,this.#t=t.navigation;let e=()=>{this.#e=void 0,this.#r=void 0};this.#t.addEventListener("navigate",()=>{let i=this.#t.transition;i&&r(i)&&i[U].promise.then(e,e);function r(o){return U in o}}),this.#t.addEventListener("currententrychange",e)}#i=new WeakMap;#e;#r;get[D](){if(this.#e)return this.#e;let{currentEntry:t}=this.#t;if(!t)return this.#r=gt(this.#n.baseURL),this.#r;let e=this.#i.get(t);if(e)return e;let i=new URL(t.url??yn);return this.#i.set(t,i),i}get hash(){return this[D].hash}set hash(t){this.#o("hash",t)}get host(){return this[D].host}set host(t){this.#o("host",t)}get hostname(){return this[D].hostname}set hostname(t){this.#o("hostname",t)}get href(){return this[D].href}set href(t){this.#o("href",t)}get origin(){return this[D].origin}get pathname(){return this[D].pathname}set pathname(t){this.#o("pathname",t)}get port(){return this[D].port}set port(t){this.#o("port",t)}get protocol(){return this[D].protocol}set protocol(t){this.#o("protocol",t)}get search(){return this[D].search}set search(t){this.#o("search",t)}#o=(t,e)=>{let i=this[D].toString(),r;t==="href"?r=new URL(e,i):(r=new URL(i),r[t]=e);let o=r.toString();i!==o&&this.#s(r,()=>this.#t.navigate(o))};replace(t){return this.#s(t,e=>this.#t.navigate(e.toString(),{history:"replace"}))}reload(){return this.#a(this.#t.reload())}assign(t){return this.#s(t,e=>this.#t.navigate(e.toString()))}[yt](t,e){return this.#s(t,e)}#s=async(t,e)=>{let i=this.#e=typeof t=="string"?new URL(t,this[D].toString()):t;try{await this.#a(e(i))}finally{this.#e===i&&(this.#e=void 0)}};[Zt](t){return this.#a(t)}#a=async t=>{if(this.#r=void 0,!t)return;let{committed:e,finished:i}=t;await Promise.all([e||Promise.resolve(void 0),i||Promise.resolve(void 0)])};#c=()=>{let t=this[D],e=t.toString(),i=this.#t.currentEntry?.url;if(e!==i)return this.#s(t,()=>this.#t.navigate(e))};[vn](){return this.#c()}};var En=Symbol.for("@virtualstate/navigation/history/state"),Et=class extends Jt{#n;#t;constructor(t){super(t),this.#n=t,this.#t=t.navigation}get length(){return this.#t.entries().length}scrollRestoration="manual";get state(){let t=this.#t.currentEntry?.getState();return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?t:this.#n[En]??void 0}back(){let t=this.#t.entries(),e=this.#t.currentEntry?.index??-1,r=t[e-1]?.url;if(!r)throw new v("Cannot go back");return this[yt](r,()=>this.#t.back())}forward(){let t=this.#t.entries(),e=this.#t.currentEntry?.index??-1,r=t[e+1]?.url;if(!r)throw new v("Cannot go forward");return this[yt](r,()=>this.#t.forward())}go(t){if(typeof t!="number"||t===0||isNaN(t))return this[Zt](this.#t.reload());let e=this.#t.entries(),{currentEntry:i}=this.#t;if(!i)throw new Error(`Could not go ${t}`);let r=i.index+t,o=e[r];if(!o)throw new Error(`Could not go ${t}`);let a=o.key;return this[Zt](this.#t.traverseTo(a))}replaceState(t,e,i){return i?this[yt](i,r=>this.#t.navigate(r.toString(),{state:t,history:"replace"})):this.#t.updateCurrentEntry({state:t})}pushState(t,e,i){return i?this[yt](i,r=>this.#t.navigate(r.toString(),{state:t})):this.#t.updateCurrentEntry({state:t})}};var Dt=typeof window>"u"?void 0:window;var ve=typeof self>"u"?void 0:self;var J="__@virtualstate/navigation/key",ye="__@virtualstate/navigation/meta";function bn(n=Dt){if(!(typeof n>"u"))return n.history}function $e(n){return G(n)&&n[ye]===!0}function bt(n){return G(n)&&$e(n[J])}function wn(n,t){t&&(typeof sessionStorage>"u"||sessionStorage.removeItem(n.key))}function Sn(n,t=rt.limit){let e=n.entries();return typeof t=="number"&&(e=e.slice(-t)),e.map(({id:i,key:r,url:o,sameDocument:a})=>({id:i,key:r,url:o,sameDocument:a}))}function xn(n,t,e=rt.limit){return{[ye]:!0,currentIndex:t.index,key:t.key,entries:Sn(n,e),state:t.getState()}}function Qt(n,t,e=rt.limit){return{[J]:xn(n,t,e)}}function Tn(n,t,e,i,r){a();function o(){return Qt(n,e,r)}function a(){if(!(typeof sessionStorage>"u"))try{let s=Ke(o());sessionStorage.setItem(e.key,s)}catch{}}}function Nn(n,t){return r()??o();function e(){try{return n.state}catch{return}}function i(){let a=n.originalState??e();return G(a)?a:void 0}function r(){let a=i();if(bt(a)&&a[J].key===t.key)return a[J].state}function o(){if(!(typeof sessionStorage>"u"))try{let a=sessionStorage.getItem(t.key);if(!a)return;let s=qe(a);return!G(s)||!bt(s)?void 0:s[J].state}catch{return}}}var rt=Object.freeze({persist:!0,persistState:!0,history:!0,limit:50,patch:!0,interceptEvents:!0});function Be(n){return G(n)&&typeof n[Rt]=="function"&&typeof n[zt]=="function"}function kn(n){let t=[{key:lt()}],e=n??new it({entries:t}),i=new Et({navigation:e});return{navigation:e,history:i,apply(){Be(n)&&!e.entries().length&&n[Rt](t)}}}function In(n,t){function e(r,o){a();function a(){if(!Cn(r))return;M(r);let s=o.getAttribute("target");if(s&&(s==="_blank"||s!==t.name))return;let c={history:"auto",[$t]:!0,[de]:o.download,[Bt]:r};n.navigate(o.href,c)}}function i(r,o){a();function a(){if(r.defaultPrevented)return;let s=r.submitter&&"formMethod"in r.submitter&&r.submitter.formMethod?r.submitter.formMethod:o.method;if(s==="dialog")return;let c=r.submitter&&"formAction"in r.submitter&&r.submitter.formAction?r.submitter.formAction:o.action,p=o.getAttribute("target");if(p&&(p==="_blank"||p!==t.name))return;let N;try{N=new FormData(o)}catch{N=new FormData(void 0)}let f=s==="get"?new URLSearchParams([...N].map(([I,j])=>j instanceof File?[I,j.name]:[I,j])):void 0,l=s==="post"?N:void 0,E=new URL(c,n.currentEntry.url);f&&(E.search=f.toString());let h=r;M(h);let S={history:"auto",[$t]:!0,[he]:l,[Bt]:h};n.navigate(E.href,S)}}t.addEventListener("click",r=>{if(r.target?.ownerDocument===t.document){let o=Ve(r);G(o)&&e(r,o)}}),t.addEventListener("submit",r=>{if(r.target?.ownerDocument===t.document){let o=ze(r);G(o)&&i(r,o)}})}function Ve(n){return Ze(Ye(n),"a[href]:not([data-navigation-ignore])")}function ze(n){return Ze(Ye(n),"form:not([data-navigation-ignore])")}function Ye(n){return n.composedPath?n.composedPath()[0]??n.target:n.target}function Ln(n,t,e){r(),a(),o();function i(s){try{Object.defineProperty(s,"navigation",{value:e})}catch{}if(!s.history)try{Object.defineProperty(s,"history",{value:t})}catch{}}function r(){if(i(n),n===Dt){if(ve)try{Object.defineProperty(ve,"navigation",{value:e})}catch{}if(typeof globalThis<"u")try{Object.defineProperty(globalThis,"navigation",{value:e})}catch{}}}function o(){if(t instanceof Et)return;let s=new Et({navigation:e}),c=s.pushState.bind(s),p=s.replaceState.bind(s),N=s.go.bind(s),f=s.back.bind(s),l=s.forward.bind(s),E=Object.getPrototypeOf(t),h={pushState:{...Object.getOwnPropertyDescriptor(E,"pushState"),value:c},replaceState:{...Object.getOwnPropertyDescriptor(E,"replaceState"),value:p},go:{...Object.getOwnPropertyDescriptor(E,"go"),value:N},back:{...Object.getOwnPropertyDescriptor(E,"back"),value:f},forward:{...Object.getOwnPropertyDescriptor(E,"forward"),value:l}};Object.defineProperties(E,h);let S=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),"state");Object.defineProperty(t,"state",{...S,get(){return s.state}}),Object.defineProperty(t,"originalState",{...S})}function a(){if(!n.PopStateEvent)return;let s=n.PopStateEvent.prototype;if(!s)return;let c=Object.getOwnPropertyDescriptor(s,"state");Object.defineProperty(s,"state",{...c,get(){let p=c.get.call(this);return bt(p)?p[J].state:p}}),Object.defineProperty(s,"originalState",{...c})}}function Je(n=rt){let{persist:t,persistState:e,history:i,limit:r,patch:o,interceptEvents:a,window:s=Dt,navigation:c}={...rt,...n},p=t||e,N=s??Dt,f=n.history&&typeof n.history!="boolean"?n.history:bn(N);if(!f)return kn();M(N,"window required when using polyfill with history, this shouldn't be seen");let l=N.location,E=f?.state,h={[ye]:!0,currentIndex:-1,entries:[],key:"",state:void 0};bt(E)&&(h=E[J]);let S=h.entries,I=!!((s||i)&&f);if(!S.length){let d;l?.href&&(d=l.href);let w;!bt(E)&&!$e(E)&&(w=E);let y=lt();S=[{key:y,state:w,url:d}],h.key=y,h.currentIndex=0}let j={entries:S,currentIndex:h?.currentIndex,currentKey:h?.key,getState(d){if(I)return Nn(f,d)},setState(d){I&&d.sameDocument&&Tn(u,f,d,p,r)},disposeState(d){I&&wn(d,p)}},u=c??new it(j),L=f?.pushState.bind(f),b=f?.replaceState.bind(f),H=f?.go.bind(f);return{navigation:u,history:f,apply(){if(Be(u)&&u[Vt](j),I){let d=new Set,w=new Set;u.addEventListener("navigate",y=>{if(y.destination.sameDocument){if(u.transition instanceof pt){let{transition:m}=u,{destination:x}=y;m.addEventListener(Gt,()=>{m[nt]||(m.navigationType==="push"?l.href=x.url:m.navigationType==="reload"&&l.reload(),m[K]())},{once:!0})}return}y.intercept({commit:"after-transition",async handler(){queueMicrotask(()=>{y.signal.aborted||C()})}});function C(){if(G(y.originalEvent)){let m=Ve(y.originalEvent);if(m)return k(m);{let x=ze(y.originalEvent);if(x)return g(x)}}l.href=y.destination.url}function k(m){let x=m.cloneNode();x.setAttribute("data-navigation-ignore","1"),x.click()}function g(m){let x=m.cloneNode();x.setAttribute("data-navigation-ignore","1"),x.submit()}}),u.addEventListener("currententrychange",({navigationType:y,from:C})=>{let{currentEntry:k,transition:g}=u;if(!k)return;let{key:m,url:x}=k;if(w.delete(m)||!k?.sameDocument)return;let W=Qt(u,k,r);switch(y||"replace"){case"push":return L(W,"",x);case"replace":return b(W,"",x);case"traverse":let Z=k.index-C.index;return d.add(m),H(Z);case"reload":}}),N.addEventListener("popstate",y=>{let{state:C,originalState:k}=y,g=k??C;if(!bt(g))return;let{[J]:{key:m}}=g;if(d.delete(m))return;w.add(m);let x;try{x=u.traverseTo(m).committed}catch(W){if(W instanceof v&&!t)return;throw W}(t||e)&&x.then(W=>{let Z=Qt(u,W,r);b(Z,"",W.url)}).catch(()=>{})})}if(a&&In(u,N),o&&Ln(N,f,u),!f.state){let d=Qt(u,u.currentEntry,r);b(d,"",u.currentEntry.url)}}}}function Cn(n){return n.button===0&&!n.defaultPrevented&&!n.metaKey&&!n.altKey&&!n.ctrlKey&&!n.shiftKey}function Ze(n,t){let e=i();for(;e;){if(e.matches(t))return M(e),e;e=e.parentElement??e.getRootNode()?.host}return;function i(){if(n)return n.matches instanceof Function?n:n.parentElement}}function Qe(n=rt){let{apply:t,navigation:e}=Je(n);return t(),e}function Xe(n=Yt()){let t=globalThis;return n!==ot&&!Object.hasOwn(t,"navigation")&&typeof window<"u"}var tn=Yt();if(Xe(tn))try{Qe({navigation:tn})}catch(n){console.error("Failed to apply polyfill"),console.error(n)}export{cn as setIgnoreWarnings,mn as setSerializer,un as setTraceWarnings};
